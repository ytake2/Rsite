---
title: "資料の整理"
output:
  html_document:
    toc: true
    toc_float: true
---


```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=FALSE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```



# 1.1 度数分布表

### 統計資料 (statistical data, データ)

- 調査、実験、既存の資料を調べて得られたデータ

> 例) ある小学校1年生の身長, 体重, 性別, 学校での満足度を知りたい

### 集団と個体

- 調査対象となる集団 = 小学校
- 集団を構成する個体 = 児童

### 変量 (variate)と属性 (attribute)

> 変量 = 個体ごとに変動する数量的な特性

- 変量= 身長, 体重

> 属性 = 個体ごとに変動する質的な特性

- 属性= 性別, 学校での満足度


### 連続変数(continuous variate) と離散変数 (discrete variable)
>　連続変量 = 測定値が実数値で表される
 - 目盛りに句切れがなく連続している (小数点がつく)

>  離散変数 = 測定値が整数でしか表せない 
 - 目盛りに句切れがある　(小数点がつかない)


### 得られた資料の整理手順
  1. 度数分布表の作成
  2. ヒストグラムを作成し, 視覚的に資料の分布を把握
  3. 代表値, 散布度等の特性値を求め、資料の分布の特徴を数量的に把握

```{r, cache=FALSE}
library(DiagrammeR)
library(magrittr)
mermaid("
graph LR
  A[資料]-->B[度数分布表] 
  B[度数分布表]-->C[図的表現]
  C[図的表現]-->D[数的表現]
")
```


# 1.1.1 度数分布表の作成

> $n$個のデータ$x_1,x_2,\dots,x_n$ を得たときの度数分布表を作成する

### 1. 最小値と最大値をみつける。  
最小値を$\alpha_0$、最大値を$\alpha_n$とする

### 2. 級の数$k$を決める  
- 最大値から最小値を引き, $k$等分
- その分点を, $\alpha_1,\alpha_2,\dots,\alpha_{k-1}$
- 級の数($k$)が大きすぎると分布の特性が表しにくく、小さすぎると部分的な特性が消されるが、データの大きさ(個数)$n$に関連して定める。
- 級の数の目安

```{r, echo=F, message=F,cache=FALSE}
library(knitr)
library(DT)
n<-c("50前後","100前後" , "100以上")
k<-c("5≦k≦7","8≦k≦12" , "10≦k≦20")
d1<-data.frame(nの大きさ=n,級数の目安=k)
datatable(d1, options = list(
    dom = 't',
    scrollX = TRUE,
    fixedColumns = TRUE
  ))
```

### 3. 級限界を決める。
- 級：$\alpha_0\sim\alpha_1,\alpha_1\sim\alpha_2,\dots, \alpha_{k-1}\sim\alpha_k(\alpha_k=\alpha_n)$

- 第1の級: $\alpha_0\sim\alpha_1$
- 第1の級の級下限界$\alpha_0$
- 第1の級の級上限界$\alpha_1$
- これらを単に級限界と呼ぶ。

### 4. 級代表値を求める。  
第$i$の級代表値：$x^*_i=\frac{\alpha_i+\alpha_{i-1}}{2} (i=1,\dots,k)$

### 5. 各級の度数と合計を求める.  
度数= 各級に属するデータの数$f_i(i=1,\dots,k)$  
度数の合計 = $n(n=f_1+f_2+\dots+f_k)$


|級                        |級代表値$x^*$| 度数$f$|
|-------------------------:|------------:|-------:|
|$\alpha_0\sim\alpha_1$    |      $x^*_1$|   $f_1$|
|$\alpha_1\sim\alpha_2$    |      $x^*_2$|   $f_2$|
|$\vdots$                  |     $\vdots$|$\vdots$|
|$\alpha_{i-1}\sim\alpha_i$|      $x^*_i$|   $f_i$|
|                  $\vdots$|     $\vdots$|$\vdots$|
|$\alpha_{n-1}\sim\alpha_n$|      $x^*_k$|   $f_k$|



# 1.1.2 ヒストグラムの作成

中学1年生100人の英語のテストの得点 (表1.2)
```{r, results='asis', cache=FALSE, echo=T}
english<-c(
  20,29,83,50,33,44,41,60,66,74,
  38,83,46,33,77,57,50,77,73,61,
  41,15,39,45,56,67,63,86,84,84,
  54,50,59,58,63,70,78,50,64,59,
  63,75,63,60,76,89,85,62,68,75,
  77,68,78,79,87,65,63,77,72,61,
  87,30,24,80,67,61,70,30,71,64,
  99,94,37,31,37,71,71,69,63,56,
  17,41,46,47,76,61,87,51,73,69,
  34,31,53,24,50,77,68,62,56,76)
```


```{r,cache=FALSE, echo=T, message=F}
print(english)
```


```{r, echo=T,cache=FALSE, results="hide"}
h1<-hist(english,breaks=seq(9.5, 99.5, 10),plot=F)

k <- length(h1$counts) # 級の数

class_names <- NULL # 級の名前格納用
rep_k <- NULL # 級の代表値格納用
for(i in 1:k) {
  class_names[i] <- paste(h1$breaks[i], "～", h1$breaks[i+1])
  rep_k[i] <-(h1$breaks[i+1]+h1$breaks[i])/2
}

frequency_table <- data.frame(級=class_names,  級代表値=rep_k,度数=h1$counts)
```


```{r,cache=FALSE}
datatable(frequency_table, extensions="Responsive",
          options=list(dom="t"))
```

```{r,cache=FALSE}
par(family="HiraMaruProN-W4")
plot(h1, xlab="英語のテスト得点(x)", ylab="度数(f)", main="", bty="l")
par(new=T)
plot(frequency_table[,2],frequency_table[,3],
     type="l",xlim=c(9.5,99.5),ylim=c(0,25),
     xlab="英語のテスト得点(x)", ylab="度数(f)", main="",col="red",bty="l")
```


# 1.2代表値と散布度

代表値= データの中心的な位置を表す量

# 1.2.1 代表値

### 平均値
- データが$x_1,x_2,\dots,x_n$の時の平均値
$\bar{x}=\frac{x_1+x_2+\dots+x_n}{n}=\frac{1}{n}\sum_{i=1}^n x_i$

- $k$個の級に分けて、その級代表値を$x^*_1,x^*_2,\dots,x^*_k$の時の平均値  
$\bar{x}=\frac{x^*_1 f_1+x^*_2 f_2+\dots+x^*_k f_k}{n}=\frac{1}{n}\sum_{i=1}^k x^*_i f_i$

- 加重平均


### 中央値
- データ$x_1,x_2,\dots,x_n$を小さい順に並べたものを以下で表す。
$x^{(1)}≦x^{(2)}≦\dots≦x^{(n-1)}≦x^{(n)}$

- この時、中央の値を`中央値(median)`といい$\tilde{x}$で表す。  

    $n$が奇数の時, 中央値$\tilde{x}=x^{((n+1)/2)}$  

    $n$が偶数の時,中央値$\tilde{x}=\frac{1}{2}(x^{(n/2)}+x^{(n/2+1)})$  
    
    
# 1.2.2 散布度
- データの分布のバラツキの程度を表す量

### 分散
$s^2=\frac{(x_1-\bar{x})^2+(x_2-\bar{x})^2+\dots+(x_n-\bar{x})^2}{n}=\frac{1}{n}\sum_{i=1}^n (x_i-\bar{x})^2$

### 標準偏差
-$s^2$が小さとき、データは$\bar{x}$付近に密集し、バラツキが大きいと$s^2$はでかくなる。  
$s^2=\frac{(x_1-\bar{x})^2+(x_2-\bar{x})^2+\dots+(x_n-\bar{x})^2}{n}=\frac{1}{n}\sum_{i=1}^n (x_i-\bar{x})^2$  

$s^2=\frac{1}{n}\sum_{i=1}^n (x^2_i)-(\bar{x})^2$  

$s=\sqrt{s^2}$

- 級に分けられたデータ  
$s^2=\frac{1}{n}\sum_{i=1}^n (x^*_i-\bar{x})^2 f_i=\frac{1}{n}\sum_{i=1}^n (x^*_i)^2 f_i-(\bar{x})^2$  

$s=\sqrt{s^2}$

$n=f_1+f_2+\dots+f_k$


# 例題1.1

> 数学の同一問題をA, B 2クラスのそれぞれ生徒20人を対象に試験を行い, その結果をもとに次の度数分布表を得た。

```{r, cache=FALSE}
class<-c("20~30","30~40","40~50","50~60",
         "60~70","70~80","80~90")
value_rep<-c(25,35,45,55,65,75,85)
A<-c(0,2,3,10,3,2,0)
B<-c(1,3,3,5,5,2,1)

tab2<-data.frame(得点=class,代表値=value_rep,Aクラス=A,Bクラス=B)

datatable(tab2)
```

> 各クラスの度数折れ線、平均、分散標準偏差を求めよ

```{r,cache=F, echo=T}
#plot(tab2[,1],tab2[,3],type="l",ylim=c(0,10))
#plot(tab2[,1],tab2[,4],type="l",ylim=c(0,10))

# Aクラスの平均
M_A=(1/sum(tab2[,3]))*sum((tab2[,2]*tab2[,3]))
M_A

# Bクラスの平均
M_B=(1/sum(tab2[,4]))*sum((tab2[,2]*tab2[,4]))
M_B

# Aクラスの分散
S2_A=(1/sum(tab2[,3]))*(sum(((tab2[,2]-M_A)^2)*tab2[,3]))
S2_A

# Bクラスの分散
S2_B=(1/sum(tab2[,4]))*(sum(((tab2[,2]-M_A)^2)*tab2[,4]))
S2_B

# Aクラスの標準偏差
sqrt(S2_A)

# Bクラスの標準偏差
sqrt(S2_B)
```



> この結果、両クラスの平均点は等しいが、Bクラスの方が標準編が大きいので、BクラスはAクラスよりもデータの散らばりの度合いが大きいと言える。




